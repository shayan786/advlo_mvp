#d_user_dashboard
  .container
    .panel.panel-default
      = render partial: "dashboard_header"
      .panel-body
        #wallet
          %h2.text-center
            %ul.nav.nav-tabs
              %li
                %a{href: "/users/wallet"}
                  Bookings
              %li.active
                %a{href: "/users/reservations"}
                  Reservations
              %li
                %a{href: "/users/payouts"} 
                  Payouts


          - if @host_reservations.empty?
            .col-md-6.col-md-offset-3.text-center
              .alert.alert-warning
                No current reservations booked
              %span= link_to 'Tips on marketing your adventure', "/adventures/info"

          - else 
            .panel-body
              .table-responsive
                %table.table.table-hover
                  %thead
                    %tr
                      %th Adventure
                      %th Status
                      %th Name / Email
                      %th Date & Time
                      %th.text-center Group Size
                      %th.text-center Reserved
                      %th $ Earned
                  %tbody
                  - @host_reservations.each_with_index do |res, i|
                    - host = res.adventure.users.first
                    - customer = User.find_by_id(res.user_id)
                    %tr
                      %td.text-left= "#{res.adventure.title}"
                      %td.text-left= res.processed ? 'completed' : 'upcoming'
                      %td.text-left
                        = image_tag "#{customer.get_avatar_url("thumb")}", class: "img-circle customer_img"
                        = customer.get_name_and_email
                      %td.text-left= res.event_start_time.strftime("%A - %m/%d/%Y - %l:%M %P")
                      %td.text-center= res.head_count
                      %td.text-center
                        - # If reservation is requested show button to approve or not
                        - if res.requested == true && !res.stripe_charge_id
                          .btn.btn-success.request_approve_btn{id: "#{res.id}"}
                            APPROVE
                          .btn.btn-danger.request_reject_btn{id: "#{res.id}"}
                            REJECT
                          .requested_approved_msg{style: "display: none;"} Request - Approved
                          .requested_rejected_msg{style: "display: none;"} Request - Rejected
                        - elsif res.requested == true && res.stripe_charge_id
                          Request - Approved
                        - else
                          Instant Reservation
                      %td.text-left= "$ "+res.total_price.to_s


:javascript
  $('.request_approve_btn').click(function(e) {
    var response = confirm("Approve this adventure request?");

    if(response == true){
      var res_id = this.getAttribute('id')

      e.preventDefault();
      $.ajax({
        url: "/reservations/" + res_id,
        dataType: "script",
        data: {approve: "true", #{request_forgery_protection_token.to_s}: "#{form_authenticity_token}"},
        type: "POST",
        method: "PUT",
        beforeSend: function() {
          $('#'+res_id+'.request_approve_btn').fadeOut(200, function() {
            $(this).remove();
          });
          $('#'+res_id+'.request_reject_btn').fadeOut(200, function() {
            $(this).remove();
          });
          $('.requested_approved_msg').fadeIn();
        }
      });
    }
  });

  $('.request_reject_btn').click(function(e) {
    var response = confirm("Reject this adventure request?");

    if(response == true){
      var res_id = this.getAttribute('id')

      e.preventDefault();
      $.ajax({
        url: "/reservations/" + res_id,
        dataType: "script",
        data: {approve: "false", #{request_forgery_protection_token.to_s}: "#{form_authenticity_token}"},
        type: "POST",
        method: "PUT",
        beforeSend: function() {
          $('#'+res_id+'.request_approve_btn').fadeOut(200, function() {
            $(this).remove();
          });
          $('#'+res_id+'.request_reject_btn').fadeOut(200, function() {
            $(this).remove();
          });
          $('.requested_rejected_msg').fadeIn();
        }
      });
    }
  });
                  
.title-brick.container-fluid
  .brick-icons.overview-scroll-icon= image_tag 'reviews.png'
  .brick-title 
    REVIEWS

.copy-brick.container-fluid#reviews
  - @adventure_reviews.each do |review|
    = render partial: '/shared/review_brick', locals: {review: review}

  
  #edit-review
    - if current_user
      - if current_user.reviews.where(adventure_id: @adventure.id).size > 0
        :javascript 
          $('#edit-review').show()

        - review_id = current_user.reviews.where(adventure_id: @adventure.id).first.id
        %form{"accept-charset" => "UTF-8", action: "/reviews/#{review_id}", method: "POST", 'data-remote' => true}
          = tag(:input, :type => "hidden", :value => "put", :name => "_method")
          = tag(:input, :type => "hidden", :name => request_forgery_protection_token.to_s, :value => form_authenticity_token)

          .form-group
            .row
              .col-md-6.col-md-offset-3
                %input.form-control{rows: '3', maxlength: "250", name: 'review[body]', type: 'text', placeholder: "Review text"}
            .row.text-center
              %input.btn.btn-primary.preview_btn.review-button{type: 'submit', value: 'Update Your Review'}

  #purchase-to-review 
    Go on this adventure to leave a review

  - if current_user
    - if current_user.reviews.where(adventure_id: @adventure.id).size > 0
      :javascript 
        $('#purchase-to-review').remove()

    - if current_user.reservations.map(&:adventure_id).include?(@adventure.id) && current_user.reviews.where(adventure_id: @adventure.id).count == 0
      :javascript 
        $('#edit-review').hide()
        $('#purchase-to-review').hide()

      #review-form
        %form#new_review.new_review{"accept-charset" => "UTF-8", action: "/reviews", "data-remote" => "true", method: "post"}
          %input{name: "utf8", type: "hidden", value: "âœ“"}
          %input#review_user_id{name: "review[user_id]", type: "hidden", value: current_user.id}
          %input#review_host_id{name: "review[host_id]", type: "hidden", value: @current_guide.id}
          %input#review_adventure_id{name: "review[adventure_id]", type: "hidden", value: @adventure.id}

          .form-group
            .row.review-textinput
              .col-md-6.col-md-offset-3
                %input.form-control{rows: '3', maxlength: "250", name: 'review[body]', type: 'text', placeholder: "Review text"}
            .row.text-center
              %input.btn.btn-primary.preview_btn.review-button{type: 'submit', value: 'Write a Review'}



:javascript
  $('#purchase-to-review').click(function(){
    $('#book-it').click()
  })
  input_maxlength();